const use_time_list = [
  {"location_id": "335","cb_id": "207","charge_division": "rapidity","upper_location_id": "334","use_time": "2000"},
  {"location_id": "335","cb_id": "207","charge_division": "rapidity","upper_location_id": "334","use_time": "3000"},
  {"location_id": "337","cb_id": "285","charge_division": "slow","upper_location_id": "334","use_time": "1000"},
  {"location_id": "337","cb_id": "285","charge_division": "slow","upper_location_id": "334","use_time": "1000"},
  {"location_id": "337","cb_id": "285","charge_division": "slow","upper_location_id": "334","use_time": "500"},
  {"location_id": "337","cb_id": "285","charge_division": "slow","upper_location_id": "334","use_time": "1500"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "3"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "3"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "3"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "171495"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "171495"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "171495"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "171219"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "171219"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "171219"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "49"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "49"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "49"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "120"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "120"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "120"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "134"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "134"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "134"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "161"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "161"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "161"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "1573"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "1573"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "1573"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "9510"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "9510"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "9510"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "14397"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "14397"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "14397"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "90690"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "90690"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "90690"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "14"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "14"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "14"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "7155"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "7155"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "7155"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "22"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "22"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "22"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "25"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "25"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "25"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "30"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "30"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "30"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "8"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "8"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "8"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "323"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "323"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "323"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "10"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "10"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "10"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "229"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "229"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "229"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "5"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "5"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "5"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "5575"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "5575"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "5575"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "18"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "18"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "18"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "0"},
  {"location_id": "337","cb_id": "208","charge_division": "rapidity","upper_location_id": "334","use_time": "5595"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "5595"},
  {"location_id": "337","cb_id": "208","charge_division": "slow","upper_location_id": "334","use_time": "5595"},
  {"location_id": "336","cb_id": "304","charge_division": "rapidity","upper_location_id": "334","use_time": "3392"},
  {"location_id": "336","cb_id": "304","charge_division": "rapidity","upper_location_id": "334","use_time": "3392"},
  {"location_id": "336","cb_id": "304","charge_division": "wireless","upper_location_id": "334","use_time": "3392"},
  {"location_id": "336","cb_id": "304","charge_division": "wireless","upper_location_id": "334","use_time": "3392"},
  {"location_id": "336","cb_id": "304","charge_division": "slow","upper_location_id": "334","use_time": "3392"},
  {"location_id": "336","cb_id": "304","charge_division": "rapidity","upper_location_id": "334","use_time": "3392"},
  {"location_id": "336","cb_id": "304","charge_division": "slow","upper_location_id": "334","use_time": "3392"},
  {"location_id": "336","cb_id": "304","charge_division": "wireless","upper_location_id": "334","use_time": "3392"}
]

const rslt_datas = [
  {location_id: 335,name: "1동 1층",loc_name: "김검증_대충 좋은 아파트_1동 1층",rapidity_install_count: 1,slow_install_count: 0,wireless_install_count: 0,total_install_count: 1,},
  {location_id: 337,name: "1동 지하 1층",loc_name: "김검증_대충 좋은 아파트_1동 지하 1층",rapidity_install_count: 2,slow_install_count: 5,wireless_install_count: 0,total_install_count: 7,},
  {location_id: 338,name: "2동 지하 1층",loc_name: "김검증_대충 좋은 아파트_2동 지하 1층",rapidity_install_count: 0,slow_install_count: 1,wireless_install_count: 0,total_install_count: 1,},
  {location_id: 336,name: "2동 1층",loc_name: "김검증_대충 좋은 아파트_2동 1층",rapidity_install_count: 3,slow_install_count: 2,wireless_install_count: 3,total_install_count: 8,},
]

const code_list = [
  {code: "rapidity",code_nm: "급속",},
  {code: "slow",code_nm: "완속",},
  {code: "wireless",code_nm: "무선",},
]
//---------------------------------------------------------------- 현 작업물
let filter_data = [];
let bunmo = 36528;

rslt_datas.reduce((pre, item, index) => {
    let location_data = use_time_list.filter(e => e.location_id == item.location_id);
  
    code_list.forEach(code => {
        let find_use_time_data = location_data.filter(it => it.charge_division == code.code);
        if(find_use_time_data.length > 0){
            let use_time_hap = parseInt(find_use_time_data.map(it => it.use_time).reduce((prev, next) => parseInt(prev) + parseInt(next)));
            let time = (parseInt(use_time_hap / 60) / parseInt(item[code.code+'_install_count'])).toFixed();
            item[code.code+'_use_rate'] = ((parseInt(time) / bunmo) * 100).toFixed(2);
            
            if(!Object.keys(item).includes('use_time_hap')){
                item['use_time_hap'] = 0;
            }
            item['use_time_hap'] += parseInt(use_time_hap);

        }else{
            if(!Object.keys(item).includes(code.code+'_use_rate')){
                item[code.code+'_use_rate'] = 0;
            }
        }
    });
    let total_time = !isNaN(item['use_time_hap']) ? (parseInt(item['use_time_hap'] / 60) / item['total_install_count']).toFixed() : 0;
    item['total_use_rate'] = ((parseInt(total_time) / bunmo) * 100).toFixed(2);

  console.log(pre, item, index);

},{})

console.log(rslt_datas)



//---------------------------------------------------------------- 이전 작업물
// const filter_data = data.filter(e => e.hasOwnProperty('use_time'))


// let rslt_datas = {};
// let rslt_datas_list = filter_data.reduce((pre, curr) => {
//   if(!pre[curr.cb_id]) pre[curr.cb_id] = [];
//   pre[curr.cb_id].push(curr);
//   return pre
// },{})

// rslt_datas_list = Object.values(rslt_datas_list)

// rslt_datas_list.forEach((element,index) => {
//   const reduce_filterData = {}
//   let code_list_add = [...code_list, {code: 'total'}]
//   let install_cnt = '_install_count'
//   let use_time_hap = '_use_time_hap'
//   for(let i = 0; i < code_list_add.length; i++) {
//     if(!reduce_filterData[code_list_add[i].code + install_cnt]) reduce_filterData[code_list_add[i].code + install_cnt] = 0;
//     if(!reduce_filterData[code_list_add[i].code + use_time_hap]) reduce_filterData[code_list_add[i].code + use_time_hap] = 0;
//   }

//   element.reduce((pre, item, index) => {
//     if(item.use_time && !isNaN(Number(item.use_time))) pre[item.charge_division + use_time_hap] += Number(item.use_time), pre['total' + use_time_hap] += Number(item.use_time);
//     if(item.charge_division) pre[item.charge_division + install_cnt] += 1;
//     pre['total' + install_cnt] += 1;
  
//     return pre
//   },reduce_filterData)

//   rslt_datas = ''
// });

// console.log(reduce_filterData)
// console.log(rslt_datas_list)



// await rslt_datas.reduce(async (pre, item, index) => {
//   return pre.then(async ()=> new Promise(async (resolve) => {
//       let total_use_rate = 0;
//       let find_data = [];
      
//       find_data = use_time_list.filter(el => el.location_id == item.location_id);


//       code_list.forEach(code => {
//           let find_use_time_data = find_data.filter(it => it.charge_division == code.code);
//           if(find_use_time_data.length > 0){
//               let use_time_hap = parseInt(find_use_time_data.map(it => it.use_time_hap).reduce((prev, next) => parseInt(prev) + parseInt(next)));
//               let time = (parseInt(use_time_hap / 60) / parseInt(item[code.code+'_install_count'])).toFixed();
//               item[code.code+'_use_rate'] = ((parseInt(time) / bunmo) * 100).toFixed(2);
              
//               if(!Object.keys(item).includes('use_time_hap')){
//                   item['use_time_hap'] = 0;
//               }
//               item['use_time_hap'] += parseInt(use_time_hap);

//           }else{
//               if(!Object.keys(item).includes(code.code+'_use_rate')){
//                   item[code.code+'_use_rate'] = 0;
//               }
//           }
//       });
//       let total_time = (parseInt(item['use_time_hap'] / 60) / item['total_install_count']).toFixed();
//       item['total_use_rate'] = ((parseInt(total_time) / bunmo) * 100).toFixed(2);

//       resolve();
//   }));
  
// }, Promise.resolve());